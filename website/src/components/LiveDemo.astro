---
import { readFileSync } from 'fs'
import { join } from 'path'
import { marked } from 'marked'
import { Badge } from 'webcoreui/astro'

const publicDir = join(process.cwd(), 'public', 'markdown')

const withoutRaw = readFileSync(join(publicDir, 'review-without-prr-kit.md'), 'utf-8')
const withRaw    = readFileSync(join(publicDir, 'review-with-prr-kit.md'), 'utf-8')

const withoutHtml = marked(withoutRaw)
const withHtml    = marked(withRaw)
---

<section id="live-demo" class="py-24 px-6 border-t border-white/10">
  <div class="max-w-7xl mx-auto">

    <!-- Header -->
    <div class="text-center mb-6 flex flex-col justify-center items-center">
      <Badge theme="outline" rounded className="text-xs mb-6">Live Example</Badge>
      <h2 class="text-4xl md:text-5xl font-black tracking-tight text-white mb-4">
        See the difference.
      </h2>
      <p class="text-white/50 text-lg max-w-2xl mx-auto">
        Same PR. Same AI. Completely different output.
      </p>
    </div>

    <!-- PR Context note -->
    <div class="mb-10 flex justify-center">
      <div class="inline-flex flex-wrap items-center gap-x-3 gap-y-2 px-5 py-3 bg-white/[0.04] border border-white/10 rounded-xl text-sm text-white/40">
        <span class="flex items-center gap-1.5">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="currentColor" class="text-white/30">
            <path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 2c4.418 0 8 3.582 8 8s-3.582 8-8 8-8-3.582-8-8 3.582-8 8-8zm0 3a5 5 0 100 10A5 5 0 0012 7zm0 2a3 3 0 110 6 3 3 0 010-6z"/>
          </svg>
          Both reviews generated by <span class="text-white/60 font-medium">GitHub Copilot</span>
          <span class="text-white/15">with</span>
          <code class="text-white/60 font-mono text-xs bg-white/8 px-1.5 py-0.5 rounded">claude-sonnet-4-5</code>
        </span>
        <span class="text-white/15 hidden sm:inline">·</span>
        <span class="flex items-center gap-1.5">
          Project:&nbsp;
          <a
            href="https://github.com/twentyhq/twenty"
            target="_blank"
            rel="noopener noreferrer"
            class="text-white/60 hover:text-white transition-colors font-medium underline underline-offset-2 decoration-white/20"
          >twentyhq/twenty</a>
        </span>
        <span class="text-white/15 hidden sm:inline">·</span>
        <span>Branch: <code class="text-white/60 font-mono text-xs bg-white/8 px-1.5 py-0.5 rounded">ai-models-and-bedrock</code></span>
        <span class="text-white/15 hidden sm:inline">·</span>
        <a
          href="https://github.com/twentyhq/twenty/pull/18155"
          target="_blank"
          rel="noopener noreferrer"
          class="text-white/60 hover:text-white transition-colors font-medium underline underline-offset-2 decoration-white/20"
        >PR #18155</a>
      </div>
    </div>

    <!-- Two review blocks -->
    <div class="grid lg:grid-cols-2 gap-6">

      <!-- Without PRR Kit -->
      <div class="flex flex-col bg-white/[0.02] border border-white/10 rounded-2xl overflow-hidden">
        <div class="flex items-center gap-3 px-5 py-4 border-b border-white/8 bg-white/[0.03] flex-shrink-0">
          <div class="flex gap-1.5">
            <span class="w-3 h-3 rounded-full bg-red-500/60"></span>
            <span class="w-3 h-3 rounded-full bg-yellow-500/60"></span>
            <span class="w-3 h-3 rounded-full bg-green-500/60"></span>
          </div>
          <span class="text-xs font-semibold text-white/30 uppercase tracking-widest ml-1">Without PRR Kit</span>
          <div class="ml-auto flex items-center gap-3">
            <span class="flex items-center gap-1.5 text-xs text-white/20">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              Standard review
            </span>
            <button
              class="fullscreen-btn text-white/25 hover:text-white/70 transition-colors cursor-pointer p-1 rounded hover:bg-white/8"
              data-title="Without PRR Kit"
              data-variant="without"
              title="Open fullscreen"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
                <path stroke-linecap="round" stroke-linejoin="round" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
              </svg>
            </button>
          </div>
        </div>
        <div id="content-without" class="overflow-y-auto h-[560px] px-6 py-5 md-content md-content--without" set:html={withoutHtml} />
      </div>

      <!-- With PRR Kit -->
      <div class="flex flex-col bg-white/[0.02] border border-white/20 rounded-2xl overflow-hidden shadow-[0_0_40px_rgba(255,255,255,0.04)]">
        <div class="flex items-center gap-3 px-5 py-4 border-b border-white/10 bg-white/[0.05] flex-shrink-0">
          <div class="flex gap-1.5">
            <span class="w-3 h-3 rounded-full bg-red-500/60"></span>
            <span class="w-3 h-3 rounded-full bg-yellow-500/60"></span>
            <span class="w-3 h-3 rounded-full bg-green-500/60"></span>
          </div>
          <span class="text-xs font-semibold text-white/60 uppercase tracking-widest ml-1">With PRR Kit</span>
          <div class="ml-auto flex items-center gap-3">
            <div class="flex items-center gap-1.5 px-2.5 py-1 bg-white/10 rounded-full">
              <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="text-white/70">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 10V3L4 14h7v7l9-11h-7z" />
              </svg>
              <span class="text-xs font-semibold text-white/70">PRR Kit</span>
            </div>
            <button
              class="fullscreen-btn text-white/35 hover:text-white/80 transition-colors cursor-pointer p-1 rounded hover:bg-white/8"
              data-title="With PRR Kit"
              data-variant="with"
              title="Open fullscreen"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
                <path stroke-linecap="round" stroke-linejoin="round" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
              </svg>
            </button>
          </div>
        </div>
        <div id="content-with" class="overflow-y-auto h-[560px] px-6 py-5 md-content md-content--with" set:html={withHtml} />
      </div>

    </div>

    <!-- Bottom note -->
    <p class="text-center text-xs text-white/20 mt-6">
      Reviews generated using GitHub Copilot with default settings (left) vs. PRR Kit structured workflow (right).
    </p>

  </div>
</section>

<!-- ── Fullscreen Modal ───────────────────────────────────────────────────── -->
<div
  id="fs-modal"
  class="fixed inset-0 z-[9999] flex flex-col bg-black/95 backdrop-blur-md opacity-0 pointer-events-none transition-opacity duration-200"
  aria-modal="true"
  role="dialog"
>
  <!-- Modal header -->
  <div class="flex items-center gap-4 px-6 py-4 border-b border-white/10 flex-shrink-0">
    <div class="flex gap-1.5">
      <span class="w-3 h-3 rounded-full bg-red-500/60"></span>
      <span class="w-3 h-3 rounded-full bg-yellow-500/60"></span>
      <span class="w-3 h-3 rounded-full bg-green-500/60"></span>
    </div>
    <span id="fs-title" class="text-sm font-semibold text-white/60 uppercase tracking-widest ml-1"></span>
    <div class="ml-auto flex items-center gap-3">
      <span class="text-xs text-white/25 hidden sm:block">Press <kbd class="px-1.5 py-0.5 bg-white/8 border border-white/10 rounded text-[10px] font-mono">Esc</kbd> to close</span>
      <button
        id="fs-close"
        class="text-white/30 hover:text-white transition-colors cursor-pointer p-2 rounded-lg hover:bg-white/8"
        title="Close fullscreen"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Modal body — scrollable markdown content -->
  <div id="fs-body" class="overflow-y-auto flex-1 px-8 py-8 md-content md-content--modal max-w-6xl mx-auto w-full"></div>
</div>

<script>
  const modal    = document.getElementById('fs-modal')!
  const fsTitle  = document.getElementById('fs-title')!
  const fsBody   = document.getElementById('fs-body')!
  const fsClose  = document.getElementById('fs-close')!

  function openModal(variant: string, title: string) {
    const src = document.getElementById(`content-${variant}`)
    if (!src) return
    fsTitle.textContent = title
    fsBody.innerHTML = src.innerHTML
    fsBody.scrollTop = 0
    modal.classList.remove('opacity-0', 'pointer-events-none')
    document.body.style.overflow = 'hidden'
  }

  function closeModal() {
    modal.classList.add('opacity-0', 'pointer-events-none')
    document.body.style.overflow = ''
  }

  document.querySelectorAll<HTMLButtonElement>('.fullscreen-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      openModal(btn.dataset.variant!, btn.dataset.title!)
    })
  })

  fsClose.addEventListener('click', closeModal)

  modal.addEventListener('click', (e) => {
    if (e.target === modal) closeModal()
  })

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeModal()
  })
</script>

<style>
/* ── Markdown content base ─────────────────────────────────────────────── */
.md-content {
  color: rgba(255,255,255,0.55);
  font-size: 0.8125rem;
  line-height: 1.7;
  scroll-behavior: smooth;
}

/* Custom scrollbar inside panels */
.md-content::-webkit-scrollbar { width: 4px; }
.md-content::-webkit-scrollbar-track { background: transparent; }
.md-content::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 2px; }
.md-content::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.2); }

/* Headings */
.md-content :global(h1) { font-size: 1.1rem; font-weight: 800; color: rgba(255,255,255,0.90); margin: 0 0 0.75rem; line-height: 1.3; }
.md-content :global(h2) { font-size: 0.95rem; font-weight: 700; color: rgba(255,255,255,0.80); margin: 1.5rem 0 0.6rem; padding-bottom: 0.4rem; border-bottom: 1px solid rgba(255,255,255,0.07); }
.md-content :global(h3) { font-size: 0.85rem; font-weight: 700; color: rgba(255,255,255,0.70); margin: 1.2rem 0 0.4rem; }
.md-content :global(h4) { font-size: 0.8rem; font-weight: 600; color: rgba(255,255,255,0.60); margin: 1rem 0 0.3rem; }

/* Paragraphs */
.md-content :global(p) { margin: 0 0 0.75rem; }

/* Links */
.md-content :global(a) { color: rgba(255,255,255,0.65); text-decoration: underline; text-underline-offset: 2px; text-decoration-color: rgba(255,255,255,0.2); }
.md-content :global(a:hover) { color: rgba(255,255,255,0.9); }

/* Lists */
.md-content :global(ul),
.md-content :global(ol) { margin: 0 0 0.75rem 1.2rem; padding: 0; }
.md-content :global(ul) { list-style-type: disc; }
.md-content :global(ol) { list-style-type: decimal; }
.md-content :global(li) { margin-bottom: 0.3rem; }
.md-content :global(li > ul),
.md-content :global(li > ol) { margin-top: 0.3rem; margin-bottom: 0; }

/* Inline code */
.md-content :global(code) {
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  font-size: 0.75rem;
  background: rgba(255,255,255,0.08) !important;
  border: 1px solid rgba(255,255,255,0.08);
  color: rgba(255,255,255,0.75);
  padding: 0.1em 0.45em;
  border-radius: 4px;
}

/* Code blocks */
.md-content :global(pre) {
  background: rgba(255,255,255,0.04) !important;
  border: 1px solid rgba(255,255,255,0.08) !important;
  border-radius: 8px;
  padding: 0.9rem 1rem !important;
  overflow-x: auto;
  margin: 0 0 0.9rem !important;
}
.md-content :global(pre code) {
  background: transparent !important;
  border: none !important;
  padding: 0;
  font-size: 0.72rem;
  color: rgba(255,255,255,0.65);
}

/* Horizontal rule */
.md-content :global(hr) {
  border: none;
  border-top: 1px solid rgba(255,255,255,0.08);
  margin: 1.25rem 0;
}

/* Blockquote */
.md-content :global(blockquote) {
  border-left: 2px solid rgba(255,255,255,0.15);
  padding-left: 0.9rem;
  margin: 0.75rem 0;
  color: rgba(255,255,255,0.4);
  font-style: italic;
}

/* Tables */
.md-content :global(table) {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.75rem;
  margin-bottom: 0.9rem;
}
.md-content :global(th) {
  background: rgba(255,255,255,0.06);
  color: rgba(255,255,255,0.65);
  font-weight: 600;
  padding: 0.4rem 0.6rem;
  text-align: left;
  border: 1px solid rgba(255,255,255,0.08);
}
.md-content :global(td) {
  padding: 0.35rem 0.6rem;
  border: 1px solid rgba(255,255,255,0.06);
  color: rgba(255,255,255,0.50);
}

/* Strong / em */
.md-content :global(strong) { color: rgba(255,255,255,0.75); font-weight: 600; }
.md-content :global(em) { color: rgba(255,255,255,0.55); }

/* "With PRR Kit" panel — slightly brighter text */
.md-content--with {
  color: rgba(255,255,255,0.65);
}
.md-content--with :global(h1) { color: rgba(255,255,255,0.95); }
.md-content--with :global(h2) { color: rgba(255,255,255,0.85); }
.md-content--with :global(h3) { color: rgba(255,255,255,0.75); }
.md-content--with :global(strong) { color: rgba(255,255,255,0.85); }

/* Modal scrollbar — slightly wider */
.md-content--modal::-webkit-scrollbar { width: 6px; }

/* Modal — larger, more readable font */
.md-content--modal {
  font-size: 0.875rem;
  color: rgba(255,255,255,0.65);
}
</style>
