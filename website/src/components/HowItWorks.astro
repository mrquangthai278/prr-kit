---
import { Badge } from 'webcoreui/astro'

const steps = [
  {
    step: '01',
    command: '/prr-master',
    title: 'Start the Agent',
    description: 'Invoke the PRR Master agent from your IDE. It reads your _prr/ configuration and presents the full workflow menu.',
    color: 'text-white',
  },
  {
    step: '02',
    command: 'SP · Select PR',
    title: 'Select Your PR',
    description: 'List open PRs via platform CLI (gh, glab, az, bb) or select branches manually. The diff loads directly into AI context.',
    color: 'text-white',
  },
  {
    step: '03',
    command: 'DP · Describe PR',
    title: 'PR Description',
    description: 'Classify PR type, generate a concise summary, and produce a file-by-file walkthrough of all changes.',
    color: 'text-white',
  },
  {
    step: '04',
    command: 'GR · SR · PR · AR',
    title: '4 Specialist Reviews',
    description: 'Four agents run in parallel or sequence: General, Security, Performance, and Architecture. Each outputs structured findings.',
    color: 'text-white',
  },
  {
    step: '05',
    command: 'RR · Generate Report',
    title: 'Generate Report',
    description: 'All findings compiled into a Markdown report, sorted by severity (BLOCKER → WARNING → SUGGESTION → QUESTION).',
    color: 'text-white',
  },
  {
    step: '06',
    command: 'PC · Post Comments',
    title: 'Post Inline Comments',
    description: 'Optionally post findings as inline code comments on the exact file and line — identical to a human reviewer experience.',
    color: 'text-white',
  },
]
---

<section id="how-it-works" class="py-24 px-6 border-t border-white/10">
  <div class="max-w-6xl mx-auto">
    <!-- Header -->
    <div class="text-center mb-16">
      <Badge theme="outline" rounded className="text-xs mb-6">Pipeline</Badge>
      <h2 class="text-4xl md:text-5xl font-black tracking-tight text-white mb-4">
        How it works
      </h2>
      <p class="text-white/50 text-lg max-w-xl mx-auto">
        A structured six-step pipeline from PR selection to inline comments, fully orchestrated by the master agent.
      </p>
    </div>

    <!-- Pipeline visualization -->
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-px bg-white/10 rounded-2xl overflow-hidden border border-white/10">
      {steps.map((step, i) => (
        <div class="relative p-8 bg-black hover:bg-white/3 transition-colors group">
          <!-- Step number -->
          <div class="text-6xl font-black text-white/5 absolute top-4 right-6 select-none group-hover:text-white/8 transition-colors">
            {step.step}
          </div>

          <!-- Content -->
          <div class="relative">
            <div class="font-mono text-xs text-white/30 mb-3 tracking-wider">{step.command}</div>
            <h3 class="text-base font-bold text-white mb-2">{step.title}</h3>
            <p class="text-sm text-white/40 leading-relaxed">{step.description}</p>
          </div>
        </div>
      ))}
    </div>

    <!-- Quick mode callout -->
    <div class="mt-8 p-6 bg-white/3 border border-white/10 rounded-2xl flex flex-col md:flex-row items-center gap-4">
      <div class="flex-shrink-0 w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z" />
        </svg>
      </div>
      <div class="flex-1 text-center md:text-left">
        <div class="font-bold text-white text-sm mb-1">Quick mode available</div>
        <p class="text-xs text-white/40">Use <code class="font-mono bg-white/10 px-1.5 py-0.5 rounded">/prr-quick</code> to run the entire pipeline automatically — only pauses once to ask which PR to review.</p>
      </div>
      <div class="font-mono text-xs bg-white/10 border border-white/10 px-4 py-2 rounded-lg text-white/60 flex-shrink-0">
        /prr-quick
      </div>
    </div>

    <!-- Severity legend -->
    <div class="mt-8 p-6 bg-white/3 border border-white/10 rounded-2xl">
      <div class="text-xs font-bold text-white/30 uppercase tracking-widest mb-4">Severity Levels</div>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        {[
          { color: 'bg-red-500', label: 'BLOCKER', desc: 'Must fix before merge' },
          { color: 'bg-yellow-400', label: 'WARNING', desc: 'Should fix' },
          { color: 'bg-green-500', label: 'SUGGESTION', desc: 'Nice-to-have' },
          { color: 'bg-blue-400', label: 'QUESTION', desc: 'Needs clarification' },
        ].map((s) => (
          <div class="flex items-start gap-2">
            <span class={`w-3 h-3 rounded-full flex-shrink-0 mt-0.5 ${s.color}`}></span>
            <div>
              <div class="text-xs font-bold text-white/70">{s.label}</div>
              <div class="text-xs text-white/30">{s.desc}</div>
            </div>
          </div>
        ))}
      </div>
    </div>
  </div>
</section>
